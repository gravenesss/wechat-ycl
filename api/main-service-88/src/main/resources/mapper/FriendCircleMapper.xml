<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dhu.ycl.mapper.FriendCircleMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.dhu.ycl.pojo.FriendCircle">
        <id column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="words" property="words"/>
        <result column="images" property="images"/>
        <result column="video" property="video"/>
        <result column="publish_time" property="publishTime"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id
        , user_id, words, images, video, publish_time
    </sql>

    <select id="queryFriendCircleList" parameterType="map" resultType="com.dhu.ycl.pojo.vo.FriendCircleVO">
        select fc.id as friendCircleId,
        fc.words as words,
        fc.images as images,
        fc.publish_time as publishTime,
        u.id as userId,
        u.nickname as userNickname,
        u.face as userFace
        from friend_circle fc left join users u on fc.user_id = u.id
        <!-- 自己的或者所有好友的 -->
        where u.id = #{paramMap.userId}
        or u.id in (select u.id as myFriendId
        from friendship fs left join users u on fs.friend_id = u.id
        where fs.my_id = #{paramMap.userId})
        order by fc.publish_time desc
    </select>

</mapper>
